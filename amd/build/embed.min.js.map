{"version":3,"file":"embed.min.js","sources":["../src/embed.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package\n * @copyright  2023 Tim Williams Streaming LTD\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/templates'], function($, ModalFactory, Templates) {\n    var module = {};\n    module.instances = [];\n    module.first = true;\n\n    module.medialinstance = function($, params) {\n        var minst = {};\n        minst.params = params;\n        minst.firsttime = true;\n\n        minst.openmodal = function(evt) {\n            evt.preventDefault();\n            minst.modal.show();\n            if (minst.firsttime) {\n                $('#mod_helixmedia_launchframe_' + minst.params.preid + minst.params.extraid).attr('src', minst.params.launchurl);\n                minst.firsttime = false;\n            }\n        };\n\n        minst.initmodal = async function() {\n            minst.modal = await ModalFactory.create({\n                title: minst.params.title,\n                body: Templates.render('mod_helixmedia/modalinner', minst.params),\n                large: true\n            });\n        };\n\n        minst.bind = function() {\n            $('#helixmedia_ltimodal_' + minst.params.preid + minst.params.extraid).click(minst.openmodal);\n            $('#helixmedia_ltimodalimg_' + minst.params.preid + minst.params.extraid).click(minst.openmodal);\n            minst.initmodal();\n        };\n\n        minst.unbind = function() {\n            $('#helixmedia_ltimodal_' + minst.params.preid + minst.params.extraid).unbind('click');\n            $('#helixmedia_ltimodalimg_' + minst.params.preid + minst.params.extraid).unbind('click');\n        };\n\n        return minst;\n    };\n\n    module.init = function(frameid, launchurl, thumburl, resID, userID, statusURL, oauthConsumerKey, doStatusCheck,\n        sessionURL, sessionFreq, resDelay, extraID, title, library) {\n\n        // AMD Modules aren't unique, so this will get called in the same instance for each MEDIAL we have on the page.\n        // That causes trouble on the quiz grading interface in particular, so wrap each call in an inner object.\n\n        // Sanity check, sometimes this gets called more than once with the same resID. Clean up the old one and re-init.\n        if (typeof module.instances[resID + extraID] !== 'undefined') {\n            module.instances[resID + extraID].unbind();\n        }\n\n        var params = {};\n        params.launchurl = launchurl;\n        params.userID = userID;\n        params.preid = resID;\n        params.extraid = extraID;\n        params.title = title;\n        if (library || doStatusCheck) {\n            params.larger = true;\n        } else {\n            params.viewonly = true;\n        }\n        var medialhandler = module.medialinstance($, params);\n        module.instances[resID + extraID] = medialhandler;\n        medialhandler.bind();\n    };\n\n    return module;\n});\n"],"names":["define","$","ModalFactory","Templates","module","params","minst","firsttime","openmodal","evt","preventDefault","modal","show","preid","extraid","attr","launchurl","initmodal","async","create","title","body","render","large","bind","click","unbind","frameid","thumburl","resID","userID","statusURL","oauthConsumerKey","doStatusCheck","sessionURL","sessionFreq","resDelay","extraID","library","instances","larger","viewonly","medialhandler","medialinstance"],"mappings":";;;;;AAqBAA,8BAAO,CAAC,SAAU,qBAAsB,mBAAmB,SAASC,EAAGC,aAAcC,eAC7EC,OAAS,CACbA,UAAmB,GACnBA,OAAe,EAEfA,eAAwB,SAASH,EAAGI,YAC5BC,MAAQ,UACZA,MAAMD,OAASA,OACfC,MAAMC,WAAY,EAElBD,MAAME,UAAY,SAASC,KACvBA,IAAIC,iBACJJ,MAAMK,MAAMC,OACRN,MAAMC,YACNN,EAAE,+BAAiCK,MAAMD,OAAOQ,MAAQP,MAAMD,OAAOS,SAASC,KAAK,MAAOT,MAAMD,OAAOW,WACvGV,MAAMC,WAAY,IAI1BD,MAAMW,UAAYC,iBACdZ,MAAMK,YAAcT,aAAaiB,OAAO,CACpCC,MAAOd,MAAMD,OAAOe,MACpBC,KAAMlB,UAAUmB,OAAO,4BAA6BhB,MAAMD,QAC1DkB,OAAO,KAIfjB,MAAMkB,KAAO,WACTvB,EAAE,wBAA0BK,MAAMD,OAAOQ,MAAQP,MAAMD,OAAOS,SAASW,MAAMnB,MAAME,WACnFP,EAAE,2BAA6BK,MAAMD,OAAOQ,MAAQP,MAAMD,OAAOS,SAASW,MAAMnB,MAAME,WACtFF,MAAMW,aAGVX,MAAMoB,OAAS,WACXzB,EAAE,wBAA0BK,MAAMD,OAAOQ,MAAQP,MAAMD,OAAOS,SAASY,OAAO,SAC9EzB,EAAE,2BAA6BK,MAAMD,OAAOQ,MAAQP,MAAMD,OAAOS,SAASY,OAAO,UAG9EpB,OAGXF,KAAc,SAASuB,QAASX,UAAWY,SAAUC,MAAOC,OAAQC,UAAWC,iBAAkBC,cAC7FC,WAAYC,YAAaC,SAAUC,QAASjB,MAAOkB,cAMF,IAAtClC,OAAOmC,UAAUV,MAAQQ,UAChCjC,OAAOmC,UAAUV,MAAQQ,SAASX,aAGlCrB,OAAS,GACbA,OAAOW,UAAYA,UACnBX,OAAOyB,OAASA,OAChBzB,OAAOQ,MAAQgB,MACfxB,OAAOS,QAAUuB,QACjBhC,OAAOe,MAAQA,MACXkB,SAAWL,cACX5B,OAAOmC,QAAS,EAEhBnC,OAAOoC,UAAW,MAElBC,cAAgBtC,OAAOuC,eAAe1C,EAAGI,QAC7CD,OAAOmC,UAAUV,MAAQQ,SAAWK,cACpCA,cAAclB,gBAGXpB"}