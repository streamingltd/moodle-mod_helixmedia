/**
 * @package
 * @copyright  2021 Tim Williams Streaming LTD
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_helixmedia/module",["jquery"],(function($){var module={instances:[],first:!0,medialinstance:function($,params){var minst={};return minst.params=params,minst.params.gotIn=!1,minst.params.medialInterval=!1,minst.params.videoref="",minst.openmodal=function(evt){evt.preventDefault();var lu=minst.params.launchurl;""!==minst.params.videorref&&(lu=lu+"&video_ref="+minst.params.videoref),$("#mod_helixmedia_launchframe_"+minst.params.docID).attr("src",lu),minst.params.bs5||$(".modal-backdrop").css("position","relative"),$(".modal-backdrop").css("z-index","0"),minst.params.doStatusCheck&&(!1!==minst.params.statusURL&&setTimeout(minst.checkStatus,500),setTimeout(minst.maintainSession,minst.params.sessionFreq)),window.addEventListener("message",minst.onmessage)},minst.onmessage=function(evt){if(evt.origin==minst.params.origin){var mform1=document.getElementById("mform1");if(null===mform1)mform1=document.getElementsByClassName("mform").item(0);var name=mform1.elements.namedItem("name");null!==name&&0==name.value.length&&(mform1.name.value=evt.data.title);var custom=mform1.elements.namedItem("custom");null!==custom&&(custom.value=JSON.stringify(evt.data.custom));var hacustom=mform1.elements.namedItem("helixassign_custom");null!==hacustom&&(hacustom.value=JSON.stringify(evt.data.custom));var hfcustom=mform1.elements.namedItem("helixfeedback_custom");null!==hfcustom&&(hfcustom.value=JSON.stringify(evt.data.custom));var addgrades=mform1.elements.namedItem("addgrades");null!==addgrades&&("true"==evt.data.custom.is_quiz.toLowerCase()?addgrades.checked=!0:addgrades.checked=!1),minst.params.videoref=evt.data.custom.video_ref,setTimeout(minst.closeDialogue,2e3)}else console.log("Message rejected: bad origin evt: "+evt.origin+" expected: "+minst.params.origin)},minst.textfit=function($){$(".helixmedia_fittext").each((function(){var w2=$(this).width();if($(this).text().length>16&&w2<240){var ratio=w2/240;$(this).css("font-size",ratio+"em")}else $(this).css("font-size","large")}))},minst.closemodalListen=function(evt){evt.preventDefault(),minst.closemodal()},minst.closemodal=function(){if(0!=minst.params.medialInterval&&(clearInterval(minst.params.medialInterval),minst.params.medialInterval=!1),$("#mod_helixmedia_launchframe_"+minst.params.docID).attr("src",""),minst.params.doStatusCheck){var tframe=document.getElementById("mod_helixmedia_thumbframe_"+minst.params.docID);null!==tframe&&void 0!==minst.params.thumburl&&(""===minst.params.videorref?tframe.contentWindow.location=minst.params.thumburl:tframe.contentWindow.location=minst.params.thumburl+"&video_ref="+minst.params.videoref)}},minst.closeDialogue=function(){$("#mod_helixmedia_modal_"+minst.params.docID).modal("hide"),minst.closemodal()},minst.bind=function(){$("#helixmedia_ltimodal_"+minst.params.docID).click(minst.openmodal),$("#mod_helixmedia_closemodal_"+minst.params.docID).click(minst.closemodalListen),minst.textfit($)},minst.unbind=function(){$("#helixmedia_ltimodal_"+minst.params.docID).off(),$("#mod_helixmedia_closemodal_"+minst.params.docID).off(),0!=minst.params.medialInterval&&(clearInterval(minst.params.medialInterval),minst.params.medialInterval=!1)},minst.maintainSession=function(){var xmlDoc=new XMLHttpRequest;xmlDoc.open("GET",minst.params.sessionURL,!0),xmlDoc.send(),setTimeout(minst.maintainSession,minst.params.sessionFreq)},minst.checkStatusResponse=function(evt){var responseText=evt.target.responseText;"IN"==responseText&&(minst.params.gotIn=!0),"OUT"!=responseText||0==minst.params.gotIn?0==minst.params.medialInterval&&(minst.params.medialInterval=setInterval(minst.checkStatus,2e3)):0==minst.params.resDelay?minst.closeDialogue():setTimeout(minst.closeDialogue,1e3*minst.params.resDelay)},minst.checkStatus=function(){var xmlDoc=new XMLHttpRequest,params="resource_link_id="+minst.params.resID+"&user_id="+minst.params.userID+"&oauth_consumer_key="+minst.params.oauthConsumerKey;xmlDoc.addEventListener("load",minst.checkStatusResponse),xmlDoc.open("POST",minst.params.statusURL),xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlDoc.send(params)},minst},init:function(frameid,launchurl,thumburl,resID,userID,statusURL,oauthConsumerKey,doStatusCheck,sessionURL,sessionFreq,resDelay,extraID,title,library,origin,bs5){void 0!==module.instances[resID+extraID]&&module.instances[resID+extraID].unbind();var params={};params.frameid=frameid,params.launchurl=launchurl,params.thumburl=thumburl,params.resID=resID,params.userID=userID,params.statusURL=statusURL,params.oauthConsumerKey=oauthConsumerKey,params.doStatusCheck=doStatusCheck,params.sessionURL=sessionURL,params.sessionFreq=sessionFreq,params.resDelay=resDelay,params.docID=resID+extraID,params.bs5=bs5,params.origin=origin;var medialhandler=module.medialinstance($,params);module.instances[params.docID]=medialhandler,medialhandler.bind()}};return module}));

//# sourceMappingURL=module.min.js.map